# CVE-2022-0537
[![License](https://img.shields.io/badge/license-MIT-brightgreen.svg)](https://opensource.org/licenses/MIT)
<br>

## Author
Qerogram<br><br>

## Version
![version](https://img.shields.io/badge/CVSS%203.1-7.2-red) ![version](https://img.shields.io/badge/php-7.4.21-blue)&nbsp; ![version](https://img.shields.io/badge/mappress%20google%20maps%20for%20wordpress-2.73.12-green)<br><br>

## Vulnerability
RCE (Remote Code Execution)<br><br>
<br><br>

## Description
The plugin allows a high privileged user to bypass the DISALLOW_FILE_EDIT and DISALLOW_FILE_MODS settings and upload arbitrary files to the site through the "ajax_save" function. The file is written relative to the current theme's stylesheet directory, and a .php file extension is added. No validation is performed on the content of the file, triggering an RCE vulnerability by uploading a web shell. Further the name parameter is not sanitized, allowing the payload to be uploaded to any directory to which the server has write access.
<br><br>

## Vector

### Step 1
|Method|Path|
|------|---|
|URI|/wp-admin/admin-ajax.php <br/> - action = mapp_tpl_save<br/> - name = filename<br/>- content = php code|
|Local Path|/wp-content/plugins/string-locator/includes/class-string-locator.php – ajax_get_directory_structure()|

<br/>

### Step 2
|Method|Path|
|------|---|
|URI|/wp-admin/admin-ajax.php <br/>- action = "string-locator-search"<br/>- filenum = "0"|
|Local Path|/wp-content/plugins/mappress-google-maps-for-wordpress/mappress_template.php – ajax_save()|


<br><br>

## How To Trigger Vulnerability
When approaching the vector, it is routed by the register function to the ajax_save function.
![image](./report_img/image.png)

<br/>

In the ajax_save function, an arbitary file write is possible. Web shell upload becomes possible
because the extension is corrected with php. Accordingly, it is possible to trigger an RCE
vulnerability by uploading a web shell.
![image](./report_img/image2.png)

<br/>

As a result, we get a execute command permission to server.
![image](./report_img/image3.png)
 

<br>

<br><br>
# Reference
[1] [Vendor](https://mappresspro.com/mappress/)
[2] [MITRE](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-0537)