# CVE-2022-0687
[![License](https://img.shields.io/badge/license-MIT-brightgreen.svg)](https://opensource.org/licenses/MIT)
<br>

## Author
Qerogram<br><br>

## Version
![version](https://img.shields.io/badge/CVSS%203.1-8.8-red) ![version](https://img.shields.io/badge/php-7.4.21-blue)&nbsp; ![version](https://img.shields.io/badge/Amelia-1.0.45-green)<br><br>

## Vulnerability
RCE (Remote Code Execution) via Arbitrary File Write<br><br>
<br><br>

## Description
The plugin stores image blobs into actual files whose extension is controlled by the user, which may lead to PHP backdoors being uploaded onto the site. This vulnerability can be exploited by logged-in users with the custom "Amelia Manager" role.
<br><br>

## Vector
|Method|Path|
|------|---|
|URI| Wpadmin -> Amelia -> Notification <br/>/wp-admin/admin-ajax.php?action=wpamelia_api&call=/notifications/1 - parameter : content|
|Local Path|/wp-content/plugins/ameliabooking/src/Application/Services/Notification/NotificationHelperService.php - parseContent ()|

![image](./report_img/image.png)

<br><br>

## How To Trigger Vulnerability
When save the notification, function /wp-content/plugins/ameliabooking/src/Application/Services/Notification/NotificationHelperService.php - parseContent () is called.
The function has a function of parsing the "img" tag and storing the file locally. At this time, if this logic is abused, the user can upload the file with the desired extension and content.
 
![image](./report_img/image2.png)

You can upload the web shell with the following example.

```html
<img src="data:image/{Extension};,{base64_encode(FILE_CONTENT)}”>
```

<br/>

> ## Example
```html
<img src="data:image/php;,{base64_encode(webshell)}”>
```
![image](./report_img/image3.png)
 

When the request is transmitted, the uploaded path is included in the response.
![image](./report_img/image4.png)

As a result, we get a execute command permission to server.
![image](./report_img/image5.png)

<br>

<br><br>
# Reference
[1] [Vendor](https://wordpress.org/plugins/ameliabooking/)