# CVE-2022-0493
[![License](https://img.shields.io/badge/license-MIT-brightgreen.svg)](https://opensource.org/licenses/MIT)
<br>

## Author
Qerogram<br><br>

## Version
![version](https://img.shields.io/badge/CVSS%203.1-4.9-red) ![version](https://img.shields.io/badge/php-7.4.21-blue)&nbsp; ![version](https://img.shields.io/badge/String%20Locator-2.4.2-green)<br><br>

## Vulnerability
Arbitrary File Read<br><br>
<br><br>

## Description
The plugin does not properly validate the path of the files to be searched, allowing high privilege users such as admin to query arbitrary files on the web server via a path traversal vector. Furthermore, due to a flaw in the search, allowing a pattern to be provided, which will be used to output the relevant matches from the matching file, all content of the file can be disclosed.
<br><br>

## Vector

### Step 1
|Method|Path|
|------|---|
|URI|/wp-admin/admin-ajax.php <br/> - action = string-locator-get-directory-structure<br/> - directory = "t-../../../../../../../{FILENAME}" // not a directory, just a file<br/>- search = /.*/i <br/>- regex = true|
|Local Path|/wp-content/plugins/string-locator/includes/class-string-locator.php – ajax_get_directory_structure()|

<br/>

### Step 2
|Method|Path|
|------|---|
|URI|/wp-admin/admin-ajax.php <br/>- action = "string-locator-search"<br/>- filenum = "0"|
|Local Path|/wp-content/plugins/string-locator/includes/class-string-locator.php – ajax_file_search()|


<br><br>

## How To Trigger Vulnerability
There are separate logics for set a target files and logics for checking files, so you have to go through a total of two processes.

### 1) Targeting Logic
In the ajax_get_directory_structure function, pre-processing of files to be searched in advance is performed. In the ajax_get_directory_structure function, pre-processing of files to be searched in advance is performed. In prepare_scan_path function, have insecure filtering is applied to path.
![image](./report_img/image.png)
<br/>

If you start with "t-", you can append all subsequent strings in the path. In this case, you can hypothesize that the sub-path can be accessed by inserting the relative path ("../"). The developer seems to have missed it because security is applied to strings starting with "p-".
![image](./report_img/image2.png)


### 2) Read Logic
In the ajax_file_search function, the scan_file function is called without a path check process.
![image](./report_img/image3.png)
<br/>

In the scan_file function, search the contents of the file without a path check process.
![image](./report_img/image4.png)

As a result, we get a file content.
![image](./report_img/image5.png)
 

<br>

<br><br>
# Reference
[1] [Vendor](https://wordpress.org/plugins/string-locator/)<br/><br/>
[2] [MITRE](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-0493)